<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Activity">

	<resultMap id="MusicLikeResult" type="MusicLike">
		<result property="music_like_sq" column="music_like_sq"/>
		<result property="target_sq" column="target_sq"/>
		<result property="member_sq" column="member_sq"/>
		<result property="music_like_type" column="music_like_type"/>
	</resultMap>


	<!--JAN 1. 좋아요 눌렀을때 실행되는 메소드 -->
	<insert id="like">
		INSERT INTO music_like(
			music_like_sq,member_sq,target_sq,music_like_type
		) VALUES (
			music_like_sq.NEXTVAL,#{target_sq}, #{member_sq},#{music_like_type}
		)
	</insert>
	
	<!--JAN 좋아요 목록 -->
	<select id="likeList" resultType="MusicLike">
		
			
			
	
	</select>
	
	<!--JAN 좋아요 동일 시퀀스 레코드체크 -->
	<select id="likeCount" resultType="int">
		SELECT COUNT(*)
		FROM music_like
		WHERE member_sq = #{member_sq}
		AND target_sq = #{target_sq}
	</select>
	
	<!--JAN unlike -->
	<delete id="likeCancel">
		DELETE FROM music_like
		WHERE music_like_sq = #{music_like_sq}
	
	</delete>
	
	<!--JAN  -->
	<update id="like_check" parameterType="HashMap">
		UPDATE music_like
		SET music_like_sq = music_like_sq + 1
		WHERE member_sq=#{member_sq} AND target_sq=#{target_sq}
	</update>
	<!--JAN  -->
	<update id="like_check_cancel" parameterType="HashMap">
		UPDATE music_like
		SET music_like_sq = 0
		WHERE member_sq=#{member_sq} AND target_sq=#{target_sq}
	</update>

	<!-- PHmaruho -->
	<select id="selectAlbumType" resultType="Code">
		SELECT *
		FROM code
		WHERE CODE_CATEGORY = 'AT'
	</select>
	
	<!-- PHmaruho -->
	<select id="selectMusicTag" resultType="Tag">
		select *
		from tag
		start with TAG_CATEGORY is null
		CONNECT BY PRIOR TAG_CD = TAG_CATEGORY
	</select>
	
	<!-- PHmaruho -->
	<insert id="insertAlbum" parameterType="Album">
		INSERT INTO album
		VALUES (
			ALBUM_SQ.NEXTVAL,
			#{album_nm},
			0,
			#{member_sq},
			#{album_comment},
			SYSDATE,
			ALBUM_SQ.CURRVAL,
			#{open_yn},
			#{album_type})
	</insert>
	
	<!-- PHmaruho -->
	<select id="selectAlbumSeq" parameterType="int" resultType="int">
		SELECT MAX(album_sq)
		FROM album
		WHERE member_sq = #{member_sq}
	</select>
	
	<!-- PHmaruho -->
	<insert id="insertAlbumMusic" parameterType="Music">
		INSERT INTO music
		VALUES(
			MUSIC_SQ.NEXTVAL,
			#{album_sq},
			#{music_no},
			#{music_nm},
			#{play_time},
			null,
			#{music_comment},
			0,0,
			#{open_yn}
		)
	</insert>
	
	<!-- PHmaruho -->
	<select id="selectAlbumMusicSeq" parameterType="int" resultType="int">
		SELECT music_sq
		FROM music
		WHERE album_sq = #{album_sq}
	</select>
	
	<!-- PHmaruho -->
	<insert id="insertArtistList" parameterType="Artist">
		INSERT INTO artist
		VALUES(
			ARTIST_SQ.NEXTVAL,
			#{music_sq},
			#{member_sq}
		)
	</insert>
	
	<!-- PHmaruho -->
	<insert id="insertMusicTagList" parameterType="MusicTag">
		INSERT INTO music_tag
		VALUES(
			MUSIC_TAG_SQ.NEXTVAL,
			#{music_sq},
			#{tag_cd}
		)
	</insert>
	
	<!-- 최우일 -->
	<select id="selectMusicDetail" parameterType="int" resultType="hashMap">
		select m.*, a.*, a.music_sq album_music_sq from music m, album a where m.music_sq = #{sq} and m.album_sq = a.album_sq
	</select>
	
	<!-- 최우일 -->
	<select id="selectMusicArtists" parameterType="int" resultType="Member">
		select m.* from artist a, member m where a.music_sq = #{sq} and a.member_sq = m.member_sq
	</select>
</mapper>
