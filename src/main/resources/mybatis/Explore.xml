<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Explore">
	<!-- JSY -->
	<select id="selectAllSearchList" parameterType="SearchKeyword" resultType="SearchList">
		select * from (
				(		select a.album_sq, a.img_path, a.album_nm, a.release_dt
								,m.music_sq, m.music_nm, m.music_no, m.music_like
								, m.music_share, m.url
								from music m, album a 
								where m.album_sq=a.album_sq 
								and a.open_yn=m.open_yn 
								and a.open_yn='Y'
								 
									  <if test="!arrTitle.contains('all')">
											and regexp_like (music_nm,trim(#{arrTitle}))
									  </if>
				  				order by album_sq,music_no
	  				)
					join 
								(		select artist_sq,music_sq,nick 
										from artist a, member m 
										where a.member_sq=m.member_sq 
										
										
									 	<if test="!arrArtist.contains('all')">
											 and regexp_like (nick,trim(#{arrArtist}))
									  	</if>
										)using(music_sq)
					)
					join 
								(		select distinct music_sq 
										from music_tag mt, tag t 
										where mt.tag_cd=t.tag_cd 
										<if test="!arrTag.contains('all')">
											and regexp_like (t.tag_meaning,trim(#{arrTag}))
										</if>
										)using (music_sq)
	</select>
	<select id="getKeywordTag" parameterType="String" resultType="Tag">
		select tag_meaning from tag where tag_meaning like '%'||#{searchWord}||'%'
	</select>
	<select id="getKeywordArtist" parameterType="String" resultType="Member">
		select nick from member where nick like '%'||#{searchWord}||'%'
	</select>
	<select id="getKeywordTitle" parameterType="String" resultType="Music">
		select music_nm from music where music_nm like '%'||#{searchWord}||'%'
	</select>

</mapper>
